resources:
  - name: source_repo
    type: GitRepo
    configuration:
      gitProvider: kashyaprahul94_github
      path: kashyaprahul94/test-jfrog-pipelines
      branches:
        include: master

  - name: prop_bag
    type: PropertyBag
    configuration:
      key1: value1

  - name: dummy_resource
    type: PropertyBag
    configuration:
      key1: value1
      
  - name: dummy_resource_1
    type: PropertyBag
    configuration:
      key1: value1

pipelines:     
  - name: pipelines_hello
    steps:  

      - name: start
        type: Bash
        execution:
          onExecute:
            - echo "Start..."
            
#       - name: step_1
#         type: Bash
#         configuration:
#           inputSteps:
#             - name: start
#         execution:
#           onStart:
#             - sleep 10
#             - add_run_variables step_1=${step_id}_${steplet_id}
#           onComplete:
#             - echo "${step_name} Completed"        
            
#       - name: step_2
#         type: Bash
#         configuration:
#           inputSteps:
#             - name: start
#         execution:
#           onStart:
#             - sleep 5
#             - add_run_variables step_2=${step_id}_${steplet_id}
#           onComplete:
#             - echo "${step_name} Completed"       
            
#       - name: step_3
#         type: Bash
#         configuration:
#           inputSteps:
#             - name: start
#         execution:
#           onStart:
#             - sleep 7
#             - add_run_variables step_3=${step_id}_${steplet_id}
#           onComplete:
#             - echo "${step_name} Completed" 
            
#       - name: finish
#         type: Bash
#         configuration:
#           inputSteps:
#             - name: step_1
#             - name: step_2
#             - name: step_3
#         execution:
#           onExecute:
#             - echo "Step 1 - ${step_1}"
#             - echo "Step 2 - ${step_2}"
#             - echo "Step 3 - ${step_3}"
#           onComplete:
#             - echo "${step_name} Completed"

      - name: step_a
        type: Bash
        configuration:
          outputResources:
            - name: dummy_resource
          inputSteps:
            - name: start
        execution:
          onStart:
            - sleep 10
            - mkdir -p files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
            - write_output dummy_resource "${step_name}_stepletId=${steplet_id}"
          onComplete:
            - echo "${step_name} Completed"

      - name: step_b
        type: Bash
        configuration:
          inputSteps:
            - name: start
          outputResources:
            - name: dummy_resource
        execution:
          onStart:
            - sleep 10
            - mkdir -p files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
            - write_output dummy_resource "${step_name}_stepletId=${steplet_id}"
          onComplete:
            - echo "${step_name} Completed"

      - name: step_e
        type: Bash
        configuration:
          outputResources:
            - name: dummy_resource_1
          inputResources:
            - name: dummy_resource
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - add_run_files ./files state
            - write_output dummy_resource_1 "${step_name}_stepletId=${steplet_id}"
          onComplete:
            - echo "${step_name} Completed"


      - name: step_f
        type: Bash
        configuration:
          outputResources:
            - name: dummy_resource_1
          inputResources:
            - name: dummy_resource
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
            - write_output dummy_resource_1 "${step_name}_stepletId=${steplet_id}"
          onExecute:
            - add_run_files ./files state
          onComplete:
            - echo "${step_name} Completed"


      - name: step_h
        type: Bash
        configuration:
          inputResources:
            - name: dummy_resource_1
        execution:
          onStart:
            - restore_run_files state ./files
            - filename="${step_name}_${steplet_number}"
            - echo "I am on step ${step_name} ${steplet_number}" > ./files/$filename
          onExecute:
            - cat ./files/*
          onComplete:
            - echo "${step_name} Completed"


  
